<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <script>


    show_review()

        // {# 리뷰 POST 기능: 전달 데이터 => 코멘트, 닉네임, 메뉴 #}

        function posting() {
            let comment = $('#comment').val()
            $.ajax({
                type: "POST",
                url: `/detail/{{ gym }}/review`,
                data: {
                    gym_give: "{{ gym }}",
                    nick_give: "{{ nickname }}",
                    comment_give: comment
                },
                success: function (response) {
                    $('#explain_noreview').empty()
                    show_review()
                }
            })

        }

        function show_review() {
            $('#reviewitems').empty()
            $.ajax({
                type: "GET",
                url: `/detail/{{ gym }}/review`,
                data: {},
                success: function (response) {
                    if (response['result'] === 'empty') {
                        let temp_html = `아직 게시된 리뷰가 없어요! 당신의 {{ gym }} 경험을 알려주세요!`
                        $('#explain_noreview').text(temp_html)

                    } else if (response['result'] === 'success') {
                        let rows = response['review_list']
                        for (let i = 0; i < rows.length; i++) {
                            let comment = rows[i]['comment_receive']
                            let nick_receive = rows[i]['nick_receive']
                            let temp_html = `<tr> <!-- 마우스오버, 아웃 이벤트 생성 -->
                                <td>${nick_receive}</td>
                                <td>${comment}</td>
                            </tr>`
                            $('#reviewitems').append(temp_html)
                        }

                    }
                }
            })
            close_post()
        }

        function close_post() {
            $('#posting-box').hide()
        }

        function open_post() {
            $('#posting-box').show()
        }

    </script>
    <title>상세페이지</title>
</head>
<body>
   <div class="review">
            <!--평가-->
            <div class="showtable">
                <table id='placetable' class='table'>
                    <thead>
                    <tr>
                        <td>닉네임</td>
                        <td>평가</td>
                    </tr>
                    </thead>
                    <tbody id="reviewitems">
                    </tbody>
                </table>
                <p id='explain_noreview' style="text-align: left; font-size: 9px"></p>
            </div>
            <div class="postbtn">
                <button onclick='open_post()'> 작성하기</button>
            </div>


            <!--인풋박스-->
            <div id="posting-box" class="posting-box">
                <!-- ##인풋박스 및 저장버튼 - 저장버튼 중간에 가게하는 방법 무엇일까여? 왜 안될까요? -->
                <div class="form-group">
                    <input class="form-control" id="comment" rows="3"
                           placeholder="{{ gym }}에 대한 나의 평가를 알려주세요!">
                </div>
                <div class="savebtn" align="center">
                    <button onclick="close_post()"> 닫기
                    </button>
                    <button onclick="posting()">등록</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>